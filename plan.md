# Markdown 投影片產生器 - 實作計劃

## 階段總覽

### 階段 1：基礎架構 (1-4)

建立 Next.js 專案基礎結構和核心配置

### 階段 2：API 層 (5-8)

實作 API 路由和 OpenAI 整合

### 階段 3：前端核心 (9-13)

建立編輯器和基本 UI 元件

### 階段 4：即時預覽 (14-17)

整合 Marp 和即時預覽功能

### 階段 5：匯出功能 (18-20)

實作 PPTX 匯出

### 階段 6：優化與測試 (21-25)

效能優化、錯誤處理和完整測試

---

## 詳細步驟

### 步驟 1：初始化 Next.js 專案

**目標**：建立基礎 Next.js 15 專案結構

- 使用 TypeScript 和 App Router
- 設定 ESLint 和 Prettier
- 建立基本資料夾結構
- 設定環境變數模板

### 步驟 2：建立 API 路由骨架

**目標**：設定 API 路由結構

- 建立 `/api/v1/slides/route.ts`
- 建立 `/api/v1/export/route.ts`
- 實作基本 HTTP 方法處理
- 加入 CORS 和基本中介層

### 步驟 3：實作資料模型和型別定義

**目標**：定義 TypeScript 介面和型別

- 建立 API 請求/回應型別
- 定義投影片資料結構
- 建立錯誤型別和常數
- 設定共用工具函數

### 步驟 4：建立基礎 UI 佈局

**目標**：實作主要版面配置

- 建立分割檢視容器
- 設定響應式佈局
- 加入基本樣式（Tailwind CSS）
- 建立頁首和控制區域

### 步驟 5：OpenAI 整合 - 基礎

**目標**：建立 OpenAI 服務層

- 建立 OpenAI 客戶端包裝器
- 實作 API Key 驗證
- 建立 prompt 模板系統
- 加入基本錯誤處理

### 步驟 6：實作投影片產生 API

**目標**：完成 `/api/v1/slides` 端點

- 實作請求驗證
- 整合 OpenAI 服務
- 加入 token 使用追蹤
- 實作基本快取（記憶體）

### 步驟 7：前端狀態管理設定

**目標**：建立狀態管理架構

- 設定 React Context（設定）
- 整合 Zustand（編輯器狀態）
- 建立 custom hooks
- 實作 localStorage 持久化

### 步驟 8：建立投影片產生表單

**目標**：實作使用者輸入介面

- 建立主題輸入表單
- 加入進階選項（頁數、樣式等）
- 實作 API Key 輸入和儲存
- 加入載入狀態和按鈕

### 步驟 9：Markdown 編輯器實作

**目標**：建立功能性編輯器

- 實作 textarea 基礎編輯器
- 加入語法高亮（highlight.js）
- 實作自動儲存
- 加入基本編輯器功能（復原/重做）

### 步驟 10：整合投影片產生流程

**目標**：連接表單、API 和編輯器

- 實作產生按鈕邏輯
- 處理 API 回應
- 更新編輯器內容
- 顯示 token 使用資訊

### 步驟 11：Marp Core 整合準備

**目標**：設定 Marp 環境

- 安裝 Marp 相依套件
- 建立動態匯入設定
- 建立預覽容器元件
- 處理 SSR 相容性

### 步驟 12：實作即時預覽

**目標**：建立功能性預覽窗格

- 實作 Marp 渲染邏輯
- 加入 debounce 機制
- 處理預覽錯誤
- 實作預覽導航

### 步驟 13：錯誤處理和 Toast 通知

**目標**：建立使用者回饋系統

- 實作 Toast 元件
- 加入全域錯誤處理
- 建立錯誤邊界
- 實作重試機制

### 步驟 14：PPTX 匯出基礎

**目標**：設定匯出基礎架構

- 整合 pptxgenjs
- 建立匯出服務層
- 實作基本 Markdown 到 PPTX 轉換
- 處理文字投影片

### 步驟 15：進階 PPTX 功能

**目標**：完成匯出功能

- 支援程式碼區塊
- 處理圖片佔位符
- 實作樣式對應
- 加入錯誤處理

### 步驟 16：實作匯出 API 端點

**目標**：完成 `/api/v1/export`

- 實作請求處理
- 產生 PPTX 二進位
- 設定正確的標頭
- 加入檔案下載邏輯

### 步驟 17：安全性實作

**目標**：加入安全措施

- 實作速率限制
- 加入 DOMPurify（XSS 防護）
- 驗證使用者輸入
- 保護 API 端點

### 步驟 18：Redis 快取整合

**目標**：實作生產級快取

- 設定 Redis 客戶端
- 實作快取邏輯
- 加入 TTL 管理
- 處理快取失效

### 步驟 19：主題系統（低優先）

**目標**：加入主題切換

- 建立主題定義
- 實作主題選擇器
- 更新預覽渲染
- 持久化主題偏好

### 步驟 20：效能優化

**目標**：優化應用程式效能

- 實作程式碼分割
- 優化重新渲染
- 加入載入優化
- 最小化套件大小

### 步驟 21：單元測試套件

**目標**：建立測試基礎架構

- 設定 Jest 和測試工具
- 為工具函數撰寫測試
- 測試 API 處理器
- 測試 React hooks

### 步驟 22：整合測試

**目標**：測試 API 端點

- 設定 Supertest
- 測試成功案例
- 測試錯誤案例
- 測試邊界情況

### 步驟 23：元件測試

**目標**：測試 UI 元件

- 設定 React Testing Library
- 測試表單互動
- 測試編輯器行為
- 測試預覽更新

### 步驟 24：E2E 測試

**目標**：測試完整使用者流程

- 設定 Playwright
- 測試產生流程
- 測試編輯和預覽
- 測試匯出功能

### 步驟 25：部署準備

**目標**：準備生產部署

- 建立 Dockerfile
- 設定 CI/CD pipeline
- 建立部署文件
- 最終整合測試

---

## 實作原則

1. **測試驅動**：每個步驟先寫測試
2. **漸進增強**：從簡單功能開始，逐步增加複雜度
3. **持續整合**：每個步驟都應產生可運作的應用程式
4. **文件優先**：在實作前記錄決策和 API
5. **錯誤處理**：從一開始就考慮錯誤情況
